<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
	<head>
		<title>Jukebox</title>
        <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
		<script type="text/javascript" src="http://documentcloud.github.com/underscore/underscore.js"></script>
		<script type="text/javascript" src="http://documentcloud.github.com/backbone/backbone.js"></script>
        <script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/jquery.templates/beta1/jquery.tmpl.min.js"></script>
        <link href='http://fonts.googleapis.com/css?family=Playball' rel='stylesheet' type='text/css'>
        <style>
body
{
    background-color:#333;
    color:Silver;
    font-family:helvetica,arial,freesans,clean,sans-serif;
    font-size : 25px;
}
a
{
    color:#40C4FF;    
    text-decoration:none;
}
a:hover
{
    text-decoration:underline;    
}
#body
{
    width:600px;    
    margin-left:30px;
}
.title
{
    font-size:80px;    
    margin-left:30px;
    font-family: 'Playball', cursive;
}
h2
{
    font-size:40px;    
    margin-top:0px;
    margin-bottom:0px;
    font-family: 'Playball', cursive;
}

        </style>
    </head> 
	<body>
        <div class="title"><a href="#">Jukebox</a></div>
        <div id="body"></div>
        <script language="javascript">

            var controllers = new function () {
                this.defaultAction = function () {
                    showView("#default", {});
                }
                this.list = function (filter) {
                    $.ajax({
                        url: '/List?Filter=' + filter,
                        dataType: 'json',
                        success: function (results) {
                            showView("#list", { items: results, filter: filter, title: filter + "s" });
                        },
                        error: function () {
                            alert('Fail');
                        }
                    });

                }
                this.songs = function (filter, value) {
                    $.ajax({
                        url: '/Songs?Filter=' + filter + '&Value=' + value,
                        dataType: 'json',
                        success: function (results) {
                            showView("#songs", { items: results, filter: filter, title: value });
                        },
                        error: function () {
                            alert('Fail');
                        }
                    });
                }
                this.song = function (id) {
                    $.ajax({
                        url: '/Song?Id=' + id,
                        dataType: 'json',
                        success: function (result) {
                            showView("#song", { song: result });
                        },
                        error: function () {
                            alert('Fail');
                        }
                    });
                }
                this.play = function (id) {
                    $.ajax({
                        url: '/Push?Id=' + id,
                        dataType: 'json',
                        success: function (result) {
                            //showView("#song", {song:result});
                            $("#" + id).text("Queued");
                        },
                        error: function () {
                            alert('Fail');
                        }
                    });
                }

            }

            function showView(tmplName, model) {
                $("#body").html($(tmplName).tmpl(model));
            };

            var AppRouter = Backbone.Router.extend({
                routes: {
					"/List/:filter": "list",
					"/Songs/:filter/:value": "songs",
					"/Songs/:filter": "songs",
                    "/Song/:id": "song",
                    "*actions": "defaultRoute"
                },
                defaultRoute: function (actions) {

                    controllers.defaultAction();
                },
				songs: function(filter,value){
					controllers.songs(filter, value);
				},
                song: function (id) {

                    controllers.song(id);
                },
				list: function(filter){
					controllers.list(filter);
				}

            });
            // Initiate the router
            var router = new AppRouter;

            // execute the default action
            $(document).ready(function () {
                Backbone.history.start();
                controllers.defaultAction();
            });
			
		</script>
        <script id="default" type="text/x-jquery-tmpl">
			<h2><a href="#/Songs/Popular"><span>Most played</span></a></h2>
			<h2><a href="#/List/Genre"><span>Genres</span></a></h2>
			<h2><a href="#/List/Artist"><span>Artists</span></a></h2>
			<h2><a href="#/List/Album"><span>Albums</span></h2>
        </script>
		
		<script id="list" type="text/x-jquery-tmpl">
			<h2>${title}</h2>
			<ul>
				{{each items}}
				<li>
					<a href="#/Songs/${filter}/${$value}">${$value}</a>
				</li>
				{{/each}}
			</ul>
        </script>

        <script id="songs" type="text/x-jquery-tmpl">
			<h2>${title}</h2>
			<ul>
				{{each items}}
				<li>
					<a href="#/Song/${$value.Id}">${$value.Title}</a> by <a href="#/Songs/Artist/${$value.Artist}">${$value.Artist}</a>
				</li>
				{{/each}}
			</ul>
        </script>

		 <script id="song" type="text/x-jquery-tmpl">
			<h2>${song.Title} by <a href="#/Songs/Artist/${song.Artist}">${song.Artist}</a></h2>
			<br/><br/>
			<span id="${song.Id}"><a href="javascript:void();" onclick="controllers.play('${song.Id}')">&#9654; Play</a></span>
        </script>


	</body>
</html>